const ce=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}};ce();function se(t,e){if(t<1)throw new Error("Unique cards must be greater than zero");const o=t*2;let i=Math.ceil(Math.sqrt(o)),n,c;for(let s=i;s<=e;s++)if(o%s==0){n=s,c=o/s;break}if(!n){i=Math.floor(Math.sqrt(o)),i>e&&(i=e);for(let s=i;s>1;s--)if(o%s==0){n=s,c=o/s;break}}return n||(n=t,c=2),n>e&&([n,c]=[c,n]),{rows:c,cols:n}}const $=sessionStorage;function q(){const t={};for(let e=0;e<15;e++)t[e]=`images/default/${e}.jpg`;return t}function ie(){return{cardSize:10,dynamic:!1,images:q()}}function re(t){$.setItem("config",JSON.stringify(t))}function z(){const t=$.getItem("config");return t?JSON.parse(t):ie()}class ae{}const u=document.querySelector(".image-editor"),C=document.querySelector(".controls .close-btn"),I=document.querySelector(".controls .accept-btn"),le=document.querySelector(".resizer"),M=new ae(le,{showZoomer:!0,mouseWheelZoom:"ctrl"}),de=new CustomEvent("close",{detail:{},bubbles:!1,cancelable:!1,composed:!1}),O=new CustomEvent("confirm",{detail:{},bubbles:!1,cancelable:!1,composed:!1});function P(){M.result("blob").then(t=>{const e=new FileReader;e.readAsDataURL(t),e.onloadend=()=>{O.detail.image=e.result,N(),u.dispatchEvent(O)}})}function D(){return u.classList.contains("open")}function ue(){u.classList.add("open"),me()}function N(){u.classList.remove("open"),fe()}function me(){C.addEventListener("click",b),I.addEventListener("click",P)}function fe(){C.removeEventListener("click",b),I.removeEventListener("click",P)}function ge(t){if(D())return;const e=new FileReader;e.onload=o=>{M.bind({url:o.target.result}).then(()=>{ue()})},e.readAsDataURL(t)}function b(){!D()||(N(),u.dispatchEvent(de))}const m=document.querySelector(".menu .new-game"),j=document.querySelector(".menu .new-game .close-btn"),G=document.querySelector(".menu .new-game .accept-btn"),L=document.querySelector("#size"),E=document.querySelector("#mode"),A=document.querySelector(".file"),f=document.querySelector("#upload"),T=document.querySelector(".image-editor"),l=document.querySelector(".cards");let r;const U=9,B=500;l.style.setProperty("--delete-time",`${B/1e3}s`);const pe=new CustomEvent("close",{detail:{},bubbles:!1,cancelable:!1,composed:!1}),R=new CustomEvent("confirm",{detail:{},bubbles:!1,cancelable:!1,composed:!1});function F(){document.querySelector("#upload").click(),f.addEventListener("change",W)}function V(t){r.cardSize=Number(t.target.value)+U,l.style.setProperty("--size",`${r.cardSize}vh`)}function J(t){r.dynamic=t.target.checked}function ve(t,e){delete r.images[t],l.removeChild(e),Object.keys(r.images).length===0&&(r.images=q(),X())}function W(){f.removeEventListener("change",W),f.files&&f.files[0]&&(ge(f.files[0]),T.addEventListener("confirm",Z))}function Z(t){T.removeEventListener("confirm",Z);const e=new Date().getTime();r.images[e]=t.detail.image,l.appendChild(Q(e,t.detail.image))}function H(){re(r),R.detail.config=r,x(),m.dispatchEvent(R)}function K(){return m.classList.contains("open")}function he(){r=z(),l.style.setProperty("--size",`${r.cardSize}vh`),L.value=r.cardSize-U,E.checked=r.dynamic,X(),m.classList.add("open"),ye()}function x(){b(),be(),Le(),m.classList.remove("open")}function ye(){A.addEventListener("click",F),L.addEventListener("change",V),E.addEventListener("change",J),j.addEventListener("click",w),G.addEventListener("click",H)}function be(){A.removeEventListener("click",F),L.removeEventListener("change",V),E.removeEventListener("change",J),j.removeEventListener("click",w),G.removeEventListener("click",H)}function Q(t,e){const o=document.createElement("div");o.classList.add("card"),o.dataset.id=t;const i=document.createElement("img");i.classList.add("thumbnail"),i.src=e,i.alt=`Image ${t}`;const n=document.createElement("img");n.classList.add("delete"),n.src="images/icons/btn-delete.svg",n.alt=`Delete Image ${t}`,o.appendChild(i),o.appendChild(n);let c;const s=()=>{c&&(clearTimeout(c),c=void 0),o.classList.contains("deleting")&&o.classList.remove("deleting")},a=()=>{s(),o.classList.contains("deleting")||o.classList.add("deleting"),c=setTimeout(()=>{ve(t,o)},B)};return o.addEventListener("mousedown",a),o.addEventListener("mouseup",s),o}function X(){Object.keys(r.images).forEach(e=>{l.appendChild(Q(e,r.images[e]))})}function Le(){const t=l.querySelectorAll(".card");for(let e=t.length-1;e>=0;e--)t[e].remove()}function Ee(){K()||he()}function w(){!K()||(x(),m.dispatchEvent(pe))}const g=document.querySelector(".menu img"),p=document.querySelector(".menu .new-game"),Y=document.querySelector(".viewport");function v(){w(),p.removeEventListener("close",v),p.removeEventListener("confirm",v),g.classList.remove("closed"),Y.classList.remove("pause"),g.addEventListener("click",S)}function S(){g.removeEventListener("click",S),g.classList.add("closed"),Y.classList.add("pause"),Ee(),p.addEventListener("close",v),p.addEventListener("confirm",v)}g.addEventListener("click",S);const d=document.querySelector(":root"),_=document.querySelector(".viewport"),we=document.querySelector(".game");let ee=16,h=10;const k=.25,te=()=>h*.1,Se=()=>({width:_.clientWidth,height:_.clientHeight});function ke(t){const{children:e}=t.target.parentNode;for(let o=0;o<e.length;o++)e[o].classList.add("flip")}function $e(t,e,o){const i=document.createElement("div");i.classList.add("card"),i.dataset.id=t;const n=document.createElement("img");n.classList.add("back"),n.src=e,n.alt="Card";const c=document.createElement("img");return c.classList.add("front"),c.src=o,c.alt=`Card ${t}`,i.appendChild(n),i.appendChild(c),i.addEventListener("click",ke),i}function ne(t){const e=t?t.detail.config:z();h=e.cardSize;const o=`images/backs/${Math.floor(Math.random()*9)}.jpg`;ee=Object.keys(e.images).length;for(let i=0;i<2;i++){const n={};let c=Object.keys(e.images);for(c.forEach(s=>{n[s]=e.images[s]}),c=Object.keys(n);c.length>0;){const s=Math.floor(Math.random()*c.length),a=c[s],y=$e(a,o,n[a]);we.appendChild(y),c.splice(s,1)}}oe()}function oe(){const{width:t,height:e}=Se(),o=e*(h/100),i=Math.floor(t/(o+o*k)),n=se(ee,i),c=n.cols*o+n.cols*o*k,s=(t-c)/2,a=n.rows*o+n.rows*o*k,y=e>a?(e-a)/2:e*(te()/100);d.style.setProperty("--cols",n.cols),d.style.setProperty("--rows",n.rows),d.style.setProperty("--size",`${h}vh`),d.style.setProperty("--gap",`${te()}vh`),d.style.setProperty("--ml",`${s}px`),d.style.setProperty("--mt",`${y}px`)}window.addEventListener("resize",oe,!0);document.querySelector(".menu .new-game").addEventListener("confirm",ne);ne();
